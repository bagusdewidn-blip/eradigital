<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adminduk C-A-K-A-P (Master Version)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }

        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
        
        /* Holographic effect for IKD */
        .holo-card {
            background: linear-gradient(135deg, #4f46e5 0%, #818cf8 50%, #c084fc 100%);
            position: relative;
            overflow: hidden;
        }
        .holo-card::before {
            content: '';
            position: absolute;
            top: 0; left: -50%; width: 200%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
            transform: skewX(-25deg);
            animation: shine 6s infinite;
        }
        @keyframes shine { 0% { left: -50%; } 20% { left: 100%; } 100% { left: 100%; } }
    </style>
</head>
<body class="flex justify-center min-h-screen">

    <!-- MOBILE CONTAINER -->
    <div id="app-container" class="w-full max-w-md bg-white min-h-screen shadow-2xl relative overflow-hidden flex flex-col">
        
        <!-- 1. SPLASH SCREEN -->
        <div id="splash-screen" class="absolute inset-0 z-50 bg-indigo-600 flex flex-col items-center justify-center text-white transition-opacity duration-500">
            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-4 shadow-lg animate-bounce">
                <i data-lucide="shield-check" class="w-12 h-12 text-indigo-600"></i>
            </div>
            <h1 class="text-3xl font-bold tracking-widest">C-A-K-A-P</h1>
            <p class="text-indigo-200 text-sm mt-2">Cepat • Akuntabel • Kolaboratif • Adaptif • Proaktif</p>
        </div>

        <!-- 2. AUTH SCREENS -->
        <div id="auth-screen" class="hidden flex-1 p-6 flex flex-col justify-center bg-white">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-gray-800">Selamat Datang</h2>
                <p class="text-gray-500">Silakan masuk untuk mengakses layanan.</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">NIK (Nomor Induk Kependudukan)</label>
                    <input type="number" id="login-nik" value="1234567890123456" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition" placeholder="16 Digit NIK">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">Password</label>
                    <input type="password" id="login-pass" value="admin123" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none transition" placeholder="Kata sandi">
                </div>
                <button onclick="handleLogin()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-indigo-700 transition transform active:scale-95">
                    MASUK
                </button>
                <p class="text-center text-sm text-gray-500 mt-4">
                    Belum punya akun? <span onclick="toggleAuthMode('register')" class="text-indigo-600 font-bold cursor-pointer">Daftar Sekarang</span>
                </p>
            </div>

            <!-- Register Form -->
            <div id="register-form" class="hidden space-y-3 overflow-y-auto max-h-[80vh] no-scrollbar pb-10">
                <h3 class="font-bold text-indigo-600">Data Diri</h3>
                <input type="text" class="w-full p-3 bg-gray-50 rounded-lg border text-sm" placeholder="Nama Lengkap">
                <input type="number" class="w-full p-3 bg-gray-50 rounded-lg border text-sm" placeholder="NIK">
                <input type="number" class="w-full p-3 bg-gray-50 rounded-lg border text-sm" placeholder="No. Kartu Keluarga">
                <button onclick="handleRegister()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl mt-4">DAFTAR AKUN</button>
                <p class="text-center text-sm text-gray-500 mt-2 mb-4">
                    Sudah punya akun? <span onclick="toggleAuthMode('login')" class="text-indigo-600 font-bold cursor-pointer">Login</span>
                </p>
            </div>
        </div>

        <!-- 3. MAIN APP CONTENT -->
        <div id="main-content" class="hidden flex-1 flex flex-col relative bg-gray-50 overflow-hidden">
            
            <!-- TOP BAR -->
            <header class="bg-white p-4 shadow-sm sticky top-0 z-20 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 font-bold">
                        <i data-lucide="user" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <p class="text-xs text-gray-500">Halo, Warga</p>
                        <h3 id="header-username" class="font-bold text-gray-800 leading-none">Nama Pengguna</h3>
                    </div>
                </div>
                <!-- Notification Button -->
                <button onclick="toggleNotifications()" class="p-2 hover:bg-gray-100 rounded-full relative transition">
                    <i data-lucide="bell" class="w-6 h-6 text-gray-600"></i>
                    <span id="notif-badge" class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white animate-pulse hidden"></span>
                </button>
            </header>

            <!-- SCROLLABLE CONTENT AREA -->
            <main id="page-content" class="flex-1 overflow-y-auto p-4 pb-24 no-scrollbar">
                <!-- Content injected via JS -->
            </main>

            <!-- BOTTOM NAVIGATION -->
            <nav class="bg-white border-t border-gray-200 absolute bottom-0 w-full flex justify-around py-3 px-2 pb-5 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <button onclick="switchTab('home')" class="nav-btn text-indigo-600" data-target="home"><i data-lucide="home" class="w-6 h-6"></i><span class="text-[10px] font-bold">Beranda</span></button>
                <button onclick="switchTab('tracking')" class="nav-btn text-gray-400" data-target="tracking"><i data-lucide="search" class="w-6 h-6"></i><span class="text-[10px] font-bold">Lacak</span></button>
                <div class="relative -top-8">
                    <button onclick="switchTab('layanan')" class="w-14 h-14 bg-indigo-600 rounded-full flex items-center justify-center text-white shadow-lg transform transition hover:scale-105 active:scale-95"><i data-lucide="plus" class="w-8 h-8"></i></button>
                </div>
                <button onclick="switchTab('ikd')" class="nav-btn text-gray-400" data-target="ikd"><i data-lucide="smartphone" class="w-6 h-6"></i><span class="text-[10px] font-bold">IKD</span></button>
                <button onclick="switchTab('profile')" class="nav-btn text-gray-400" data-target="profile"><i data-lucide="user-cog" class="w-6 h-6"></i><span class="text-[10px] font-bold">Profil</span></button>
            </nav>

            <!-- 4. NOTIFICATION MODAL (POPUP) -->
            <div id="notif-modal" class="absolute inset-0 bg-black/50 z-50 hidden flex items-end transition-opacity duration-300">
                <div class="bg-white w-full rounded-t-2xl max-h-[70vh] overflow-y-auto animate-slide-up shadow-2xl">
                    <div class="p-4 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white z-10">
                        <h3 class="font-bold text-lg text-gray-800">Notifikasi</h3>
                        <button onclick="toggleNotifications()" class="p-1 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200"><i data-lucide="x" class="w-5 h-5"></i></button>
                    </div>
                    <div id="notif-list" class="p-4 space-y-3 pb-10">
                        <!-- Notif items injected via JS -->
                    </div>
                    <div class="p-4 border-t border-gray-100 text-center">
                        <button onclick="markAllRead()" class="text-xs font-bold text-indigo-600 uppercase tracking-wide">Tandai Semua Dibaca</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DATABASE "MOCK" ---
        const mockDB = {
            users: [{ nik: "1234567890123456", password: "admin123", name: "Sefti Indriyani", kk: "3201000000000001", address: "Jl. Mawar No. 10, Bandar Lampung" }],
            // Default kosong agar User bisa menekan tombol Simulasi
            tracking: [], 
            services: [
                { id: 'ktp', name: "Buat E-KTP", icon: "id-card", bg: "bg-blue-100", color: "text-blue-600" },
                { id: 'kk', name: "Kartu Keluarga", icon: "users", bg: "bg-green-100", color: "text-green-600" },
                { id: 'pindah', name: "Surat Pindah", icon: "truck", bg: "bg-orange-100", color: "text-orange-600" },
                { id: 'akta', name: "Akta Lahir", icon: "baby", bg: "bg-pink-100", color: "text-pink-600" },
                { id: 'kia', name: "Kartu Anak (KIA)", icon: "smile", bg: "bg-purple-100", color: "text-purple-600" },
                { id: 'mati', name: "Akta Kematian", icon: "file-minus", bg: "bg-gray-200", color: "text-gray-600" },
            ],
            notifications: [
                { id: 1, title: "Pengingat IKD (Proaktif)", message: "Hindari kelangkaan blanko! Segera aktifkan Identitas Kependudukan Digital Anda sekarang.", time: "Baru saja", type: "alert", read: false },
                { id: 3, title: "Selamat Datang", message: "Selamat datang di aplikasi C-A-K-A-P.", time: "1 hari yang lalu", type: "info", read: true }
            ]
        };

        let currentUser = null;
        let activeTab = 'home';

        // --- 2. LOGIKA UTAMA ---
        window.onload = () => {
            lucide.createIcons();
            setTimeout(() => {
                document.getElementById('splash-screen').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('splash-screen').style.display = 'none';
                    document.getElementById('auth-screen').classList.remove('hidden');
                }, 500);
            }, 2000);
        };

        function toggleAuthMode(mode) {
            if(mode === 'register') {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
            } else {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
            }
        }

        function handleLogin() {
            const nik = document.getElementById('login-nik').value;
            const pass = document.getElementById('login-pass').value;
            const user = mockDB.users.find(u => u.nik === nik && u.password === pass);

            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('header-username').textContent = user.name;
                updateNotifBadge();
                renderPage('home');
            } else {
                alert("Gunakan NIK: 1234567890123456 dan Pass: admin123");
            }
        }

        function handleRegister() {
            alert("Registrasi Berhasil! Silakan Login.");
            toggleAuthMode('login');
        }

        function switchTab(tabName) {
            activeTab = tabName;
            document.querySelectorAll('.nav-btn').forEach(btn => {
                const isTarget = btn.dataset.target === tabName;
                btn.className = isTarget ? 'nav-btn text-indigo-600 flex flex-col items-center' : 'nav-btn text-gray-400 flex flex-col items-center';
            });
            renderPage(tabName);
        }

        // --- 3. LOGIKA NOTIFIKASI ---
        function toggleNotifications() {
            const modal = document.getElementById('notif-modal');
            const listContainer = document.getElementById('notif-list');
            
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                listContainer.innerHTML = '';

                if (mockDB.notifications.length === 0) {
                    listContainer.innerHTML = '<p class="text-center text-gray-500 text-sm py-10">Tidak ada notifikasi.</p>';
                } else {
                    mockDB.notifications.forEach(notif => {
                        let icon = notif.type === 'alert' ? 'smartphone' : notif.type === 'success' ? 'check-circle' : 'info';
                        let bgClass = notif.type === 'alert' ? 'bg-yellow-100 text-yellow-600' : notif.type === 'success' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600';
                        const isReadClass = notif.read ? 'opacity-60' : 'bg-indigo-50/50 border-l-4 border-indigo-500';

                        listContainer.innerHTML += `
                            <div class="flex gap-3 p-3 rounded-lg ${isReadClass} transition-colors">
                                <div class="flex-shrink-0 w-10 h-10 ${bgClass} rounded-full flex items-center justify-center">
                                    <i data-lucide="${icon}" class="w-5 h-5"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <h4 class="text-sm font-bold text-gray-800">${notif.title}</h4>
                                        <span class="text-[10px] text-gray-400 whitespace-nowrap ml-2">${notif.time}</span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1 leading-relaxed">${notif.message}</p>
                                </div>
                            </div>`;
                    });
                }
                lucide.createIcons();
            } else {
                modal.classList.add('hidden');
            }
        }

        function updateNotifBadge() {
            const unreadCount = mockDB.notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notif-badge');
            if (unreadCount > 0) {
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function markAllRead() {
            mockDB.notifications.forEach(n => n.read = true);
            toggleNotifications(); 
            updateNotifBadge();
        }

        // --- 4. SIMULASI PENGAJUAN (KEMBALI DIADAKAN) ---
        function simulateNewRequest() {
            const newReg = {
                id: "REG-" + Math.floor(Math.random() * 10000),
                userId: currentUser.nik,
                service: "Pembuatan E-KTP Baru",
                status: "PENCETAKAN",
                updatedAt: new Date().toISOString(),
                history: [
                    { step: "Pengajuan Masuk", date: "Hari ini", done: true },
                    { step: "Verifikasi Dokumen", date: "Baru saja", done: true },
                    { step: "Perekaman Biometrik", date: "Terkonfirmasi", done: true },
                    { step: "Antrian Pencetakan", date: "Sedang Proses", done: false },
                    { step: "Selesai", date: null, done: false }
                ]
            };
            
            // Tambah ke Tracking
            mockDB.tracking.unshift(newReg);
            
            // Tambah ke Notifikasi (Proaktif)
            mockDB.notifications.unshift({ 
                id: Date.now(), 
                title: "Pengajuan Diterima", 
                message: `Pengajuan Anda (${newReg.id}) telah diterima dan sedang diproses.`, 
                time: "Baru saja", 
                type: "success", 
                read: false 
            });
            
            alert("Simulasi Berhasil! Pengajuan baru telah dibuat.");
            updateNotifBadge();
            renderPage('home');
        }

        // --- 5. RENDER PAGE ---
        function renderPage(page) {
            const container = document.getElementById('page-content');
            container.innerHTML = ''; 
            window.scrollTo(0,0);

            if (page === 'home') {
                const myTracking = mockDB.tracking[0]; // Ambil yang terbaru
                let trackingHTML = '';

                if (myTracking) {
                    // Tampilan Jika Ada Tracking (Card Status)
                    trackingHTML = `
                    <div class="bg-white p-4 rounded-2xl shadow-md border border-gray-100 mb-6 animate-fade-in">
                         <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm">Status Terkini</h4>
                                <p class="text-xs text-gray-500">${myTracking.service}</p>
                            </div>
                            <span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-[10px] font-bold animate-pulse">PROSES</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: 75%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>${myTracking.id}</span>
                            <span>Langkah 3 dari 4</span>
                        </div>
                        <button onclick="switchTab('tracking')" class="w-full mt-3 text-indigo-600 text-xs font-bold border border-indigo-100 py-2 rounded-lg hover:bg-indigo-50">Lihat Detail</button>
                    </div>`;
                } else {
                    // Tampilan Jika KOSONG (Tombol Simulasi) - FITUR YANG SEMPAT HILANG
                    trackingHTML = `
                    <div class="bg-indigo-50 border border-indigo-100 rounded-2xl p-6 text-center mb-6 animate-fade-in">
                        <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 text-indigo-600 shadow-sm">
                            <i data-lucide="file-plus" class="w-6 h-6"></i>
                        </div>
                        <h4 class="font-bold text-gray-800 mb-1">Belum Ada Pengajuan</h4>
                        <p class="text-xs text-gray-500 mb-4">Mulai layanan adminduk Anda sekarang secara digital.</p>
                        <button onclick="simulateNewRequest()" class="bg-indigo-600 text-white px-5 py-2.5 rounded-full text-sm font-bold shadow-lg hover:bg-indigo-700 transform active:scale-95 transition">
                            + Simulasi Pengajuan Baru
                        </button>
                    </div>`;
                }

                container.innerHTML = `
                    <!-- Info Banner -->
                    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-4 text-white mb-6 shadow-lg animate-fade-in">
                        <p class="text-xs opacity-80 font-semibold mb-1">VISI C-A-K-A-P</p>
                        <h2 class="font-bold text-lg leading-tight">Layanan Adminduk yang Proaktif & Digital</h2>
                    </div>

                    ${trackingHTML}

                    <h3 class="font-bold text-gray-800 mb-3">Layanan Digital</h3>
                    <div class="grid grid-cols-3 gap-3 mb-20">
                        ${mockDB.services.map(s => `
                            <div class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm border border-gray-100 active:scale-95 transition cursor-pointer" onclick="alert('Fitur ini akan membuka formulir: ${s.name}')">
                                <div class="w-10 h-10 ${s.bg} rounded-full flex items-center justify-center mb-2">
                                    <i data-lucide="${s.icon}" class="w-5 h-5 ${s.color}"></i>
                                </div>
                                <span class="text-[10px] font-bold text-gray-700 text-center">${s.name}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (page === 'tracking') {
                const t = mockDB.tracking[0];
                if (!t) {
                    container.innerHTML = `<div class="text-center py-20 text-gray-400"><i data-lucide="search" class="w-12 h-12 mx-auto mb-2"></i><p>Belum ada data pelacakan.</p></div>`;
                } else {
                    const steps = t.history.map(h => `
                        <div class="relative pl-6 pb-6 border-l-2 ${h.done ? 'border-green-500' : 'border-gray-200'} last:border-0">
                            <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 rounded-full ${h.done ? 'bg-green-500' : 'bg-gray-300'}"></div>
                            <p class="text-xs font-bold ${h.done ? 'text-gray-800' : 'text-gray-400'}">${h.step}</p>
                            <p class="text-[10px] text-gray-500">${h.date || ''}</p>
                        </div>
                    `).join('');
                    container.innerHTML = `<div class="bg-white p-5 rounded-2xl shadow-sm"><h2 class="font-bold text-lg mb-4 text-indigo-600">Detail Pelacakan</h2>${steps}</div>`;
                }
            } else if (page === 'ikd') {
                container.innerHTML = `
                    <h2 class="font-bold text-lg mb-4 text-indigo-600">KTP Digital (IKD)</h2>
                    <div class="holo-card rounded-xl p-5 text-white shadow-lg mb-4">
                        <div class="flex justify-between mb-6">
                            <i data-lucide="shield" class="w-6 h-6 opacity-80"></i>
                            <span class="text-[10px] border border-white/40 px-2 py-0.5 rounded">AKTIF</span>
                        </div>
                        <h3 class="font-bold text-xl mb-1">${currentUser.name.toUpperCase()}</h3>
                        <p class="font-mono text-sm opacity-80">${currentUser.nik}</p>
                        <div class="mt-6 flex items-center justify-between border-t border-white/20 pt-3">
                            <span class="text-[10px]">Berlaku Seumur Hidup</span>
                            <i data-lucide="qr-code" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <p class="text-center text-xs text-gray-500">Tunjukkan QR Code ini kepada petugas.</p>
                `;
            } else if (page === 'profile') {
                container.innerHTML = `
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center mb-4 border border-gray-100">
                        <div class="w-20 h-20 bg-indigo-100 rounded-full mx-auto flex items-center justify-center text-indigo-600 mb-3"><i data-lucide="user" class="w-10 h-10"></i></div>
                        <h2 class="font-bold text-gray-800">${currentUser.name}</h2>
                        <p class="text-sm text-gray-500">${currentUser.nik}</p>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden mb-6">
                        <button class="w-full p-4 text-left text-sm flex justify-between items-center border-b border-gray-50 hover:bg-gray-50"><span>Pengaturan Akun</span><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></button>
                        <button class="w-full p-4 text-left text-sm flex justify-between items-center border-b border-gray-50 hover:bg-gray-50"><span>Bantuan & FAQ</span><i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i></button>
                        <button onclick="location.reload()" class="w-full p-4 text-left text-sm font-bold text-red-500 hover:bg-red-50 flex items-center gap-2"><i data-lucide="log-out" class="w-4 h-4"></i> Keluar Aplikasi</button>
                    </div>
                `;
            } else if (page === 'layanan') {
                renderPage('home');
            }
            lucide.createIcons();
        }
    </script>
</body>
</html>
